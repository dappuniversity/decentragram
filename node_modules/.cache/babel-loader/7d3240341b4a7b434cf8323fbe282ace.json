{"ast":null,"code":"'use strict';\n\nvar dagPB = require('ipld-dag-pb');\n\nvar dagCBOR = require('ipld-dag-cbor');\n\nvar raw = require('ipld-raw');\n\nvar promisify = require('promisify-es6');\n\nvar CID = require('cids');\n\nvar waterfall = require('async/waterfall');\n\nvar block = require('../block');\n\nvar resolvers = {\n  'dag-cbor': dagCBOR.resolver,\n  'dag-pb': dagPB.resolver,\n  raw: raw.resolver\n};\n\nmodule.exports = function (send) {\n  return promisify(function (cid, path, options, callback) {\n    if (typeof path === 'function') {\n      callback = path;\n      path = undefined;\n    }\n\n    if (typeof options === 'function') {\n      callback = options;\n      options = {};\n    }\n\n    options = options || {};\n    path = path || '';\n\n    if (CID.isCID(cid)) {\n      cid = cid.toBaseEncodedString();\n    }\n\n    waterfall([function (cb) {\n      send({\n        path: 'dag/resolve',\n        args: cid + '/' + path,\n        qs: options\n      }, cb);\n    }, function (resolved, cb) {\n      block(send).get(new CID(resolved['Cid']['/']), function (err, ipfsBlock) {\n        cb(err, ipfsBlock, resolved['RemPath']);\n      });\n    }, function (ipfsBlock, path, cb) {\n      var dagResolver = resolvers[ipfsBlock.cid.codec];\n\n      if (!dagResolver) {\n        var error = new Error(\"Missing IPLD format \\\"\".concat(ipfsBlock.cid.codec, \"\\\"\"));\n        error.missingMulticodec = ipfsBlock.cid.codec;\n        return cb(error);\n      }\n\n      var res;\n\n      try {\n        res = dagResolver.resolve(ipfsBlock.data, path);\n      } catch (err) {\n        return cb(err);\n      }\n\n      cb(null, res);\n    }], callback);\n  });\n};","map":null,"metadata":{},"sourceType":"script"}