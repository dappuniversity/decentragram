{"ast":null,"code":"var Writable = require('readable-stream').Writable;\n\nvar inherits = require('inherits');\n\nvar U8 = Uint8Array;\n\nfunction ConcatStream(opts, cb) {\n  if (!(this instanceof ConcatStream)) return new ConcatStream(opts, cb);\n\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  if (!opts) opts = {};\n  var encoding = opts.encoding;\n  var shouldInferEncoding = false;\n\n  if (!encoding) {\n    shouldInferEncoding = true;\n  } else {\n    encoding = String(encoding).toLowerCase();\n\n    if (encoding === 'u8' || encoding === 'uint8') {\n      encoding = 'uint8array';\n    }\n  }\n\n  Writable.call(this, {\n    objectMode: true\n  });\n  this.encoding = encoding;\n  this.shouldInferEncoding = shouldInferEncoding;\n  if (cb) this.on('finish', function () {\n    cb(this.getBody());\n  });\n  this.body = [];\n}\n\nmodule.exports = ConcatStream;\ninherits(ConcatStream, Writable);\n\nConcatStream.prototype._write = function (chunk, enc, next) {\n  this.body.push(chunk);\n  next();\n};\n\nConcatStream.prototype.inferEncoding = function (buff) {\n  var firstBuffer = buff === undefined ? this.body[0] : buff;\n  if (Buffer.isBuffer(firstBuffer)) return 'buffer';\n  if (typeof Uint8Array !== 'undefined' && firstBuffer instanceof Uint8Array) return 'uint8array';\n  if (Array.isArray(firstBuffer)) return 'array';\n  if (typeof firstBuffer === 'string') return 'string';\n  if (Object.prototype.toString.call(firstBuffer) === \"[object Object]\") return 'object';\n  return 'buffer';\n};\n\nConcatStream.prototype.getBody = function () {\n  if (!this.encoding && this.body.length === 0) return [];\n  if (this.shouldInferEncoding) this.encoding = this.inferEncoding();\n  if (this.encoding === 'array') return arrayConcat(this.body);\n  if (this.encoding === 'string') return stringConcat(this.body);\n  if (this.encoding === 'buffer') return bufferConcat(this.body);\n  if (this.encoding === 'uint8array') return u8Concat(this.body);\n  return this.body;\n};\n\nfunction isArrayish(arr) {\n  return /Array\\]$/.test(Object.prototype.toString.call(arr));\n}\n\nfunction isBufferish(p) {\n  return typeof p === 'string' || isArrayish(p) || p && typeof p.subarray === 'function';\n}\n\nfunction stringConcat(parts) {\n  var strings = [];\n\n  for (var i = 0; i < parts.length; i++) {\n    var p = parts[i];\n\n    if (typeof p === 'string') {\n      strings.push(p);\n    } else if (Buffer.isBuffer(p)) {\n      strings.push(p);\n    } else if (isBufferish(p)) {\n      strings.push(Buffer.from(p));\n    } else {\n      strings.push(Buffer.from(String(p)));\n    }\n  }\n\n  if (Buffer.isBuffer(parts[0])) {\n    strings = Buffer.concat(strings);\n    strings = strings.toString('utf8');\n  } else {\n    strings = strings.join('');\n  }\n\n  return strings;\n}\n\nfunction bufferConcat(parts) {\n  var bufs = [];\n\n  for (var i = 0; i < parts.length; i++) {\n    var p = parts[i];\n\n    if (Buffer.isBuffer(p)) {\n      bufs.push(p);\n    } else if (isBufferish(p)) {\n      bufs.push(Buffer.from(p));\n    } else {\n      bufs.push(Buffer.from(String(p)));\n    }\n  }\n\n  return Buffer.concat(bufs);\n}\n\nfunction arrayConcat(parts) {\n  var res = [];\n\n  for (var i = 0; i < parts.length; i++) {\n    res.push.apply(res, parts[i]);\n  }\n\n  return res;\n}\n\nfunction u8Concat(parts) {\n  var len = 0;\n\n  for (var i = 0; i < parts.length; i++) {\n    if (typeof parts[i] === 'string') {\n      parts[i] = Buffer.from(parts[i]);\n    }\n\n    len += parts[i].length;\n  }\n\n  var u8 = new U8(len);\n\n  for (var i = 0, offset = 0; i < parts.length; i++) {\n    var part = parts[i];\n\n    for (var j = 0; j < part.length; j++) {\n      u8[offset++] = part[j];\n    }\n  }\n\n  return u8;\n}","map":null,"metadata":{},"sourceType":"script"}