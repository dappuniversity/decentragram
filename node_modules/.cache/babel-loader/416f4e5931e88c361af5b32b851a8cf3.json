{"ast":null,"code":"'use strict';\n\nvar promisify = require('promisify-es6');\n\nvar CID = require('cids');\n\nvar _require = require('ipld-dag-pb'),\n    DAGNode = _require.DAGNode;\n\nvar SendOneFile = require('../utils/send-one-file');\n\nvar once = require('once');\n\nmodule.exports = function (send) {\n  var sendOneFile = SendOneFile(send, 'object/put');\n  return promisify(function (obj, options, _callback) {\n    if (typeof options === 'function') {\n      _callback = options;\n      options = {};\n    }\n\n    var callback = once(_callback);\n\n    if (!options) {\n      options = {};\n    }\n\n    var tmpObj = {\n      Data: null,\n      Links: []\n    };\n\n    if (Buffer.isBuffer(obj)) {\n      if (!options.enc) {\n        tmpObj = {\n          Data: obj.toString(),\n          Links: []\n        };\n      }\n    } else if (DAGNode.isDAGNode(obj)) {\n      tmpObj = {\n        Data: obj.Data.toString(),\n        Links: obj.Links.map(function (l) {\n          return {\n            Name: l.Name,\n            Hash: l.Hash.toString(),\n            Size: l.Tsize\n          };\n        })\n      };\n    } else if (typeof obj === 'object') {\n      tmpObj.Data = obj.Data.toString();\n      tmpObj.Links = obj.Links;\n    } else {\n      return callback(new Error('obj not recognized'));\n    }\n\n    var buf;\n\n    if (Buffer.isBuffer(obj) && options.enc) {\n      buf = obj;\n    } else {\n      buf = Buffer.from(JSON.stringify(tmpObj));\n    }\n\n    var enc = options.enc || 'json';\n    var sendOptions = {\n      qs: {\n        inputenc: enc\n      }\n    };\n    sendOneFile(buf, sendOptions, function (err, result) {\n      if (err) {\n        return callback(err); // early\n      }\n\n      callback(null, new CID(result.Hash));\n    });\n  });\n};","map":null,"metadata":{},"sourceType":"script"}