{"ast":null,"code":"'use strict';\n\nvar _require = require('readable-stream'),\n    Transform = _require.Transform,\n    PassThrough = _require.PassThrough;\n\nvar pump = require('pump');\n\nvar ndjson = require('ndjson');\n\nvar isStream = require('is-stream');\n\nvar toEntry = function toEntry(entry) {\n  return {\n    name: entry.Name,\n    type: entry.Type,\n    size: entry.Size,\n    hash: entry.Hash\n  };\n};\n\nmodule.exports = function (send) {\n  return function (args, opts) {\n    opts = opts || {};\n    var transform = new Transform({\n      objectMode: true,\n      transform: function transform(entry, encoding, callback) {\n        callback(null, toEntry(entry));\n      }\n    });\n    var output = new PassThrough({\n      objectMode: true\n    });\n    send({\n      path: 'files/ls',\n      args: args,\n      qs: Object.assign({}, opts, {\n        stream: true\n      })\n    }, function (err, res) {\n      if (err) {\n        return output.destroy(err);\n      }\n\n      if (isStream(res)) {\n        var parse = ndjson.parse();\n        pump(res, parse, transform, output);\n      } else {\n        var entries = res.Entries || [];\n        entries.forEach(function (entry) {\n          output.write(toEntry(entry));\n        });\n        output.end();\n      }\n    });\n    return output;\n  };\n};","map":null,"metadata":{},"sourceType":"script"}