{"ast":null,"code":"'use strict';\n\nvar schema = require('protocol-buffers-schema');\n\nvar _require = require('buffer'),\n    Buffer = _require.Buffer;\n\nvar compile = require('./compile');\n\nvar flatten = function flatten(values) {\n  if (!values) return null;\n  var result = {};\n  Object.keys(values).forEach(function (k) {\n    result[k] = values[k].value;\n  });\n  return result;\n};\n\nmodule.exports = function (proto, opts) {\n  if (!opts) opts = {};\n  if (!proto) throw new Error('Pass in a .proto string or a protobuf-schema parsed object');\n  var sch = typeof proto === 'object' && !Buffer.isBuffer(proto) ? proto : schema.parse(proto); // to not make toString,toJSON enumarable we make a fire-and-forget prototype\n\n  var Messages = function Messages() {\n    var self = this;\n    compile(sch, opts.encodings || {}).forEach(function (m) {\n      self[m.name] = flatten(m.values) || m;\n    });\n  };\n\n  Messages.prototype.toString = function () {\n    return schema.stringify(sch);\n  };\n\n  Messages.prototype.toJSON = function () {\n    return sch;\n  };\n\n  return new Messages();\n};","map":null,"metadata":{},"sourceType":"script"}