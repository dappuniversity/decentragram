{"ast":null,"code":"'use strict';\n\nvar BN = require('./bn');\n\nfunction ECJPoint(x, y, z) {\n  if (x === null && y === null && z === null) {\n    this.x = ECJPoint.one;\n    this.y = ECJPoint.one;\n    this.z = ECJPoint.zero;\n  } else {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n  }\n\n  this.zOne = this.z === ECJPoint.one;\n}\n\nECJPoint.zero = BN.fromNumber(0);\nECJPoint.one = BN.fromNumber(1);\n\nECJPoint.prototype.neg = function () {\n  if (this.inf) return this;\n  return new ECJPoint(this.x, this.y.redNeg(), this.z);\n};\n\nECJPoint.prototype.add = function (p) {\n  // O + P = P\n  if (this.inf) return p; // P + O = P\n\n  if (p.inf) return this; // http://hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#addition-add-1998-cmo-2\n  // 12M + 4S + 7A\n\n  var pz2 = p.z.redSqr();\n  var z2 = this.z.redSqr();\n  var u1 = this.x.redMul(pz2);\n  var u2 = p.x.redMul(z2);\n  var s1 = this.y.redMul(pz2).redMul(p.z);\n  var s2 = p.y.redMul(z2).redMul(this.z);\n  var h = u1.redSub(u2);\n  var r = s1.redSub(s2);\n\n  if (h.isZero()) {\n    if (r.isZero()) return this.dbl();\n    return new ECJPoint(null, null, null);\n  }\n\n  var h2 = h.redSqr();\n  var v = u1.redMul(h2);\n  var h3 = h2.redMul(h);\n  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);\n  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));\n  var nz = this.z.redMul(p.z).redMul(h);\n  return new ECJPoint(nx, ny, nz);\n};\n\nECJPoint.prototype.mixedAdd = function (p) {\n  // O + P = P\n  if (this.inf) return p.toECJPoint(); // P + O = P\n\n  if (p.inf) return this; // http://hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#addition-add-1998-cmo-2\n  //   with p.z = 1\n  // 8M + 3S + 7A\n\n  var z2 = this.z.redSqr();\n  var u1 = this.x;\n  var u2 = p.x.redMul(z2);\n  var s1 = this.y;\n  var s2 = p.y.redMul(z2).redMul(this.z);\n  var h = u1.redSub(u2);\n  var r = s1.redSub(s2);\n\n  if (h.isZero()) {\n    if (r.isZero()) return this.dbl();\n    return new ECJPoint(null, null, null);\n  }\n\n  var h2 = h.redSqr();\n  var v = u1.redMul(h2);\n  var h3 = h2.redMul(h);\n  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);\n  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));\n  var nz = this.z.redMul(h);\n  return new ECJPoint(nx, ny, nz);\n};\n\nECJPoint.prototype.dbl = function () {\n  if (this.inf) return this;\n  var nx;\n  var ny;\n  var nz; // Z = 1\n\n  if (this.zOne) {\n    // http://hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#doubling-mdbl-2007-bl\n    // 1M + 5S + 6A + 3*2 + 1*3 + 1*8\n    // XX = X1^2\n    var xx = this.x.redSqr(); // YY = Y1^2\n\n    var yy = this.y.redSqr(); // YYYY = YY^2\n\n    var yyyy = yy.redSqr(); // S = 2 * ((X1 + YY)^2 - XX - YYYY)\n\n    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n    s = s.redIAdd(s); // M = 3 * XX\n\n    var m = xx.redAdd(xx).redIAdd(xx); // T = M ^ 2 - 2*S\n\n    var t = m.redSqr().redISub(s).redISub(s); // 8 * YYYY\n\n    var yyyy8 = yyyy.redIAdd(yyyy).redIAdd(yyyy).redIAdd(yyyy); // X3 = T\n\n    nx = t; // Y3 = M * (S - T) - 8 * YYYY\n\n    ny = m.redMul(s.redISub(t)).redISub(yyyy8); // Z3 = 2*Y1\n\n    nz = this.y.redAdd(this.y);\n  } else {\n    // http://hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#doubling-dbl-2009-l\n    // 2M + 5S + 6A + 3*2 + 1*3 + 1*8\n    // A = X1^2\n    var a = this.x.redSqr(); // B = Y1^2\n\n    var b = this.y.redSqr(); // C = B^2\n\n    var c = b.redSqr(); // D = 2 * ((X1 + B)^2 - A - C)\n\n    var d = this.x.redAdd(b).redSqr().redISub(a).redISub(c);\n    d = d.redIAdd(d); // E = 3 * A\n\n    var e = a.redAdd(a).redIAdd(a); // F = E^2\n\n    var f = e.redSqr(); // 8 * C\n\n    var c8 = c.redIAdd(c).redIAdd(c).redIAdd(c); // X3 = F - 2 * D\n\n    nx = f.redISub(d).redISub(d); // Y3 = E * (D - X3) - 8 * C\n\n    ny = e.redMul(d.redISub(nx)).redISub(c8); // Z3 = 2 * Y1 * Z1\n\n    nz = this.y.redMul(this.z);\n    nz = nz.redIAdd(nz);\n  }\n\n  return new ECJPoint(nx, ny, nz);\n};\n\nECJPoint.prototype.dblp = function (pow) {\n  if (pow === 0 || this.inf) return this;\n  var point = this;\n\n  for (var i = 0; i < pow; i++) {\n    point = point.dbl();\n  }\n\n  return point;\n};\n\nObject.defineProperty(ECJPoint.prototype, 'inf', {\n  enumerable: true,\n  get: function get() {\n    return this.z.isZero();\n  }\n});\nmodule.exports = ECJPoint;","map":null,"metadata":{},"sourceType":"script"}